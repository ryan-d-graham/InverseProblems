from os import system
import numpy as np #Numerical Python stuffs
import pandas as pd #Pandas Data stuffs
from pandas_ods_reader import read_ods #Convert Libre Office Spreadsheet data to Pandas DataFrame object
from matplotlib import pyplot as plt #plotting with the matrix plotting library
import networkx as nx #plotting graphical networks to visualize expert and inferred causal structures
from pgmpy.readwrite import BIFReader, BIFWriter #Save trained models as a Bayesian Inference File (.bif) and load them later 
from pgmpy.models import BayesianModel
from pgmpy.factors.discrete import TabularCPD, State
from pgmpy.inference import BeliefPropagation
from pgmpy.sampling import BayesianModelSampling, GibbsSampling
from pgmpy.estimators import HillClimbSearch, BicScore, MaximumLikelihoodEstimator
import tensorflow as tf
import tensorflow_probability as tfp

num_steps = 5 #How many links in markov model?

#Helper methods for network diagnostics
def PrintCPDs(model, description):
	cpdList = model.get_cpds()
	print(description+"\n")
	for n,cpd in enumerate(cpdList):
		nodeList = list(model.nodes())
		print("\n\n")
		print("CPD for node "+nodeList[n]+"\n")
		print(cpd)
		print("\n\n")
	
def SaveGraph(model, filename, fmt="PNG"): #saves the inferred and expert models as .png image files in working directory
	nodes = model.nodes()
	edges = model.edges()
	graph = nx.DiGraph() #instantiate a DiGraph (Directed Graph) object
	graph.add_nodes_from(nodes) #take node list from pgmpy and send it to DiGraph object
	graph.add_edges_from(edges) #take edges list from pgmpy and send it to DiGraph object
	nx.draw_networkx(graph, arrows=True) #draw the Bayesian Network
	plt.tight_layout() #fit all plotted objects within viewing frame
	plt.savefig(filename, format=fmt) #save in working directory as .png
	plt.clf() #close matplotlib plot instance (used to generate graph)

system('clear')
def make_names(root="Node",n=10,subscript=""): #default name = 'Node', default Markov Chain length = 10 nodes
	names = []
	for i in range(n):
		names.append(root+subscript+str(i))
	return names

def markov_chain(root_list,order):
	ebunch = []
	for n in range(len(root_list)-order):
		ebunch.append([root_list[n],root_list[n+order]])
	return ebunch

def make_intra_slices(cause_list, effect_list, markov_lag=0): #Markov_lag=1 sets cause[i] -> effect[i+1] otherwise cause[i] -> effect[i]
	ebunch = []
	if(len(cause_list) != len(effect_list)):
		print("Lists must be the same length!")
		pass
	else:
		for i in range(len(cause_list)-markov_lag):
			ebunch.append([cause_list[i],effect_list[i+markov_lag]])
	return ebunch
	

namesNap = make_names(root="Nap",n=num_steps,subscript="")
namesPlay = make_names(root="Play",n=num_steps,subscript="")
namesMeal = make_names(root="Meal",n=num_steps,subscript="")
namesMood = make_names(root="Mood",n=num_steps,subscript="")
namesBehavior = make_names(root="Behavior",n=num_steps,subscript="")
#Create 1st-order markov chains for each node
napChain = markov_chain(namesNap,1)
playChain = markov_chain(namesPlay,1)
mealChain = markov_chain(namesMeal,1)
moodChain = markov_chain(namesMood,1)
behaviorChain = markov_chain(namesBehavior,1)
#Create 2nd-order markov chains for each node
napChain2 = markov_chain(namesNap,2)
playChain2 = markov_chain(namesPlay,2)
mealChain2 = markov_chain(namesMeal,2)
moodChain2 = markov_chain(namesMood,2)
behaviorChain2 = markov_chain(namesBehavior,2)
#Create intra-slices with/without markov lags
nap_mood_edges = make_intra_slices(namesNap,namesMood,markov_lag=1)
play_mood_edges = make_intra_slices(namesPlay,namesMood,markov_lag=0)
meal_mood_edges = make_intra_slices(namesMeal,namesMood,markov_lag=1)
mood_behavior_edges = make_intra_slices(namesMood,namesBehavior,markov_lag=0)
		
WulfNet = BayesianModel() #Using BayesianModel to Dynamic Bayesian Network model structure
# First-Order Markov Process with 1st-Order Markov Assumption definition following
# Nap[0] -> Nap[1] -> Nap[2]; Now P(Nap[n+1]|Nap[0],Nap[1],...,Nap[n]) = P(Nap[n+1]|Nap[n])

#Add 1st-order Markov Chains to model
WulfNet.add_edges_from(napChain)
WulfNet.add_edges_from(playChain)
WulfNet.add_edges_from(mealChain)
WulfNet.add_edges_from(moodChain)
WulfNet.add_edges_from(behaviorChain)
"""#Add 2nd-order Markov Chains to model
WulfNet.add_edges_from(napChain2)
WulfNet.add_edges_from(playChain2)
WulfNet.add_edges_from(mealChain2)
WulfNet.add_edges_from(moodChain2)
WulfNet.add_edges_from(behaviorChain2)"""
#Add intra-slices to model with/without markov lags
WulfNet.add_edges_from(meal_mood_edges)
WulfNet.add_edges_from(nap_mood_edges)
WulfNet.add_edges_from(play_mood_edges)
WulfNet.add_edges_from(mood_behavior_edges)

cpd_nap0 = TabularCPD(variable='Nap0', variable_card=2, values = [[0.9],[0.1]])
cpd_nap1 = TabularCPD(variable='Nap1', variable_card=2, values = [[0.9, 0.1],
								  [0.1, 0.9]], evidence=['Nap0'], evidence_card=[2])
cpd_nap2 = TabularCPD(variable='Nap2', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap1'], evidence_card=[2])
cpd_nap3 = TabularCPD(variable='Nap3', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap2'], evidence_card=[2])
cpd_nap4 = TabularCPD(variable='Nap4', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap3'], evidence_card=[2])

cpd_nap5 = TabularCPD(variable='Nap5', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap4'], evidence_card=[2])
"""
cpd_nap6 = TabularCPD(variable='Nap6', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap5'], evidence_card=[2])
cpd_nap7 = TabularCPD(variable='Nap7', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap6'], evidence_card=[2])
cpd_nap8 = TabularCPD(variable='Nap8', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap7'], evidence_card=[2])
cpd_nap9 = TabularCPD(variable='Nap9', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap8'], evidence_card=[2])
cpd_nap10 = TabularCPD(variable='Nap10', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap9'], evidence_card=[2])
cpd_nap11 = TabularCPD(variable='Nap11', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap10'], evidence_card=[2])
cpd_nap12 = TabularCPD(variable='Nap12', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap11'], evidence_card=[2])
cpd_nap13 = TabularCPD(variable='Nap13', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap12'], evidence_card=[2])
cpd_nap14 = TabularCPD(variable='Nap14', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap13'], evidence_card=[2])
cpd_nap15 = TabularCPD(variable='Nap15', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap14'], evidence_card=[2])
cpd_nap16 = TabularCPD(variable='Nap16', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap15'], evidence_card=[2])
cpd_nap17 = TabularCPD(variable='Nap17', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap16'], evidence_card=[2])
cpd_nap18 = TabularCPD(variable='Nap18', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap17'], evidence_card=[2])
cpd_nap19 = TabularCPD(variable='Nap19', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap18'], evidence_card=[2])
cpd_nap20 = TabularCPD(variable='Nap20', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap19'], evidence_card=[2])
cpd_nap21 = TabularCPD(variable='Nap21', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap20'], evidence_card=[2])
cpd_nap22 = TabularCPD(variable='Nap22', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap21'], evidence_card=[2])
cpd_nap23 = TabularCPD(variable='Nap23', variable_card=2, values = [[0.7, 0.2],
								  [0.3, 0.8]], evidence=['Nap22'], evidence_card=[2])"""
								  
cpd_play0 = TabularCPD(variable='Play0', variable_card=2, values = [[0.7],[0.3]])
cpd_play1 = TabularCPD(variable='Play1', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Play0'], evidence_card=[2])
cpd_play2 = TabularCPD(variable='Play2', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play1'], evidence_card=[2])		  
cpd_play3 = TabularCPD(variable='Play3', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play2'], evidence_card=[2])		  
cpd_play4 = TabularCPD(variable='Play4', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play3'], evidence_card=[2])
		  
cpd_play5 = TabularCPD(variable='Play5', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play4'], evidence_card=[2])	  
"""
cpd_play6 = TabularCPD(variable='Play6', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play5'], evidence_card=[2])		  
cpd_play7 = TabularCPD(variable='Play7', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play6'], evidence_card=[2])		  
cpd_play8 = TabularCPD(variable='Play8', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play7'], evidence_card=[2])		  
cpd_play9 = TabularCPD(variable='Play9', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play8'], evidence_card=[2])		  
cpd_play10 = TabularCPD(variable='Play10', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play9'], evidence_card=[2])		  
cpd_play11 = TabularCPD(variable='Play11', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play10'], evidence_card=[2])		  
cpd_play12 = TabularCPD(variable='Play12', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play11'], evidence_card=[2])		  
cpd_play13 = TabularCPD(variable='Play13', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play12'], evidence_card=[2])		  
cpd_play14 = TabularCPD(variable='Play14', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play13'], evidence_card=[2])		  
cpd_play15 = TabularCPD(variable='Play15', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play14'], evidence_card=[2])		  
cpd_play16 = TabularCPD(variable='Play16', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play15'], evidence_card=[2])		  
cpd_play17 = TabularCPD(variable='Play17', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play16'], evidence_card=[2])		  
cpd_play18 = TabularCPD(variable='Play18', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play17'], evidence_card=[2])		  
cpd_play19 = TabularCPD(variable='Play19', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play18'], evidence_card=[2])		  
cpd_play20 = TabularCPD(variable='Play20', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play19'], evidence_card=[2])		  
cpd_play21 = TabularCPD(variable='Play21', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play20'], evidence_card=[2])		  
cpd_play22 = TabularCPD(variable='Play22', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play21'], evidence_card=[2])		  
cpd_play23 = TabularCPD(variable='Play23', variable_card=2, values = [[0.7, 0.2],
								    [0.3, 0.8]], evidence=['Play22'], evidence_card=[2])"""		  

cpd_meal0 = TabularCPD(variable='Meal0', variable_card=2, values = [[0.7],[0.3]])
cpd_meal1 = TabularCPD(variable='Meal1', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal0'], evidence_card=[2])
cpd_meal2 = TabularCPD(variable='Meal2', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal1'], evidence_card=[2])
cpd_meal3 = TabularCPD(variable='Meal3', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal2'], evidence_card=[2])
cpd_meal4 = TabularCPD(variable='Meal4', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal3'], evidence_card=[2])

cpd_meal5 = TabularCPD(variable='Meal5', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal4'], evidence_card=[2])
"""
cpd_meal6 = TabularCPD(variable='Meal6', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal5'], evidence_card=[2])
cpd_meal7 = TabularCPD(variable='Meal7', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal6'], evidence_card=[2])
cpd_meal8 = TabularCPD(variable='Meal8', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal7'], evidence_card=[2])
cpd_meal9 = TabularCPD(variable='Meal9', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal8'], evidence_card=[2])
cpd_meal10 = TabularCPD(variable='Meal10', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal9'], evidence_card=[2])
cpd_meal11 = TabularCPD(variable='Meal11', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal10'], evidence_card=[2])
cpd_meal12 = TabularCPD(variable='Meal12', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal11'], evidence_card=[2])
cpd_meal13 = TabularCPD(variable='Meal13', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal12'], evidence_card=[2])
cpd_meal14 = TabularCPD(variable='Meal14', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal13'], evidence_card=[2])
cpd_meal15 = TabularCPD(variable='Meal15', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal14'], evidence_card=[2])
cpd_meal16 = TabularCPD(variable='Meal16', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal15'], evidence_card=[2])
cpd_meal17 = TabularCPD(variable='Meal17', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal16'], evidence_card=[2])
cpd_meal18 = TabularCPD(variable='Meal18', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal17'], evidence_card=[2])
cpd_meal19 = TabularCPD(variable='Meal19', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal18'], evidence_card=[2])
cpd_meal20 = TabularCPD(variable='Meal20', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal19'], evidence_card=[2])
cpd_meal21 = TabularCPD(variable='Meal21', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal20'], evidence_card=[2])
cpd_meal22 = TabularCPD(variable='Meal22', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal21'], evidence_card=[2])
cpd_meal23 = TabularCPD(variable='Meal23', variable_card=2, values = [[0.9, 0.1],
								    [0.1, 0.9]], evidence=['Meal22'], evidence_card=[2])"""
								    
cpd_mood0 = TabularCPD(variable='Mood0', variable_card=2, values = [[0.1,0.9],
								    [0.9,0.1]], evidence=['Play0'], evidence_card=[2])
cpd_mood1 = TabularCPD(variable='Mood1', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood0','Nap0','Meal0','Play1'], evidence_card=[2,2,2,2])
cpd_mood2 = TabularCPD(variable='Mood2', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood1','Nap1','Meal1','Play2'], evidence_card=[2,2,2,2])
cpd_mood3 = TabularCPD(variable='Mood3', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood2','Nap2','Meal2','Play3'], evidence_card=[2,2,2,2])
cpd_mood4 = TabularCPD(variable='Mood4', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood3','Nap3','Meal3','Play4'], evidence_card=[2,2,2,2])

cpd_mood5 = TabularCPD(variable='Mood5', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood4','Nap4','Meal4','Play5'], evidence_card=[2,2,2,2])
"""
cpd_mood6 = TabularCPD(variable='Mood6', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood5','Nap5','Meal5','Play6'], evidence_card=[2,2,2,2])
cpd_mood7 = TabularCPD(variable='Mood7', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood6','Nap6','Meal6','Play7'], evidence_card=[2,2,2,2])
cpd_mood8 = TabularCPD(variable='Mood8', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood7','Nap7','Meal7','Play8'], evidence_card=[2,2,2,2])
cpd_mood9 = TabularCPD(variable='Mood9', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood8','Nap8','Meal8','Play9'], evidence_card=[2,2,2,2])
cpd_mood10 = TabularCPD(variable='Mood10', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood9','Nap9','Meal9','Play10'], evidence_card=[2,2,2,2])
cpd_mood11 = TabularCPD(variable='Mood11', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood10','Nap10','Meal10','Play11'], evidence_card=[2,2,2,2])
cpd_mood12 = TabularCPD(variable='Mood12', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood11','Nap11','Meal11','Play12'], evidence_card=[2,2,2,2])
cpd_mood13 = TabularCPD(variable='Mood13', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood12','Nap12','Meal12','Play13'], evidence_card=[2,2,2,2])
cpd_mood14 = TabularCPD(variable='Mood14', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood13','Nap13','Meal13','Play14'], evidence_card=[2,2,2,2])
cpd_mood15 = TabularCPD(variable='Mood15', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood14','Nap14','Meal14','Play15'], evidence_card=[2,2,2,2])
cpd_mood16 = TabularCPD(variable='Mood16', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood15','Nap15','Meal15','Play16'], evidence_card=[2,2,2,2])
cpd_mood17 = TabularCPD(variable='Mood17', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood16','Nap16','Meal16','Play17'], evidence_card=[2,2,2,2])
cpd_mood18 = TabularCPD(variable='Mood18', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood17','Nap17','Meal17','Play18'], evidence_card=[2,2,2,2])
cpd_mood19 = TabularCPD(variable='Mood19', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood18','Nap18','Meal18','Play19'], evidence_card=[2,2,2,2])
cpd_mood20 = TabularCPD(variable='Mood20', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood19','Nap19','Meal19','Play20'], evidence_card=[2,2,2,2])
cpd_mood21 = TabularCPD(variable='Mood21', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood20','Nap20','Meal20','Play21'], evidence_card=[2,2,2,2])
cpd_mood22 = TabularCPD(variable='Mood22', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood21','Nap21','Meal21','Play22'], evidence_card=[2,2,2,2])
cpd_mood23 = TabularCPD(variable='Mood23', variable_card=2, values = [[0.9,0.7,0.8,0.6,0.7,0.7,0.6,0.5,0.5,0.3,0.4,0.2,0.4,0.2,0.3,0.1],
								    [0.1,0.3,0.2,0.4,0.3,0.3,0.4,0.5,0.5,0.7,0.6,0.8,0.6,0.8,0.7,0.9,]], evidence=['Mood22','Nap22','Meal22','Play23'], evidence_card=[2,2,2,2])"""
								    								    
cpd_behavior0 = TabularCPD(variable='Behavior0', variable_card=2, values = [[0.7,0.2],
								            [0.3,0.8]], evidence=['Mood0'], evidence_card=[2])
cpd_behavior1 = TabularCPD(variable='Behavior1', variable_card=2, values = [[0.8,0.4,0.6,0.2],
									    [0.2,0.6,0.4,0.8]], evidence=['Behavior0','Mood1'], evidence_card=[2,2])
cpd_behavior2 = TabularCPD(variable='Behavior2', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior1','Mood2'], evidence_card=[2,2])
cpd_behavior3 = TabularCPD(variable='Behavior3', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior2','Mood3'], evidence_card=[2,2])
cpd_behavior4 = TabularCPD(variable='Behavior4', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior3','Mood4'], evidence_card=[2,2])

cpd_behavior5 = TabularCPD(variable='Behavior5', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior4','Mood5'], evidence_card=[2,2])
"""
cpd_behavior6 = TabularCPD(variable='Behavior6', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior5','Mood6'], evidence_card=[2,2])
cpd_behavior7 = TabularCPD(variable='Behavior7', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior6','Mood7'], evidence_card=[2,2])
cpd_behavior8 = TabularCPD(variable='Behavior8', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior7','Mood8'], evidence_card=[2,2])
cpd_behavior9 = TabularCPD(variable='Behavior9', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior8','Mood9'], evidence_card=[2,2])
cpd_behavior10 = TabularCPD(variable='Behavior10', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior9','Mood10'], evidence_card=[2,2])
cpd_behavior11 = TabularCPD(variable='Behavior11', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior10','Mood11'], evidence_card=[2,2])
cpd_behavior12 = TabularCPD(variable='Behavior12', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior11','Mood12'], evidence_card=[2,2])
cpd_behavior13 = TabularCPD(variable='Behavior13', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior12','Mood13'], evidence_card=[2,2])
cpd_behavior14 = TabularCPD(variable='Behavior14', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior13','Mood14'], evidence_card=[2,2])
cpd_behavior15 = TabularCPD(variable='Behavior15', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior14','Mood15'], evidence_card=[2,2])
cpd_behavior16 = TabularCPD(variable='Behavior16', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior15','Mood16'], evidence_card=[2,2])
cpd_behavior17 = TabularCPD(variable='Behavior17', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior16','Mood17'], evidence_card=[2,2])
cpd_behavior18 = TabularCPD(variable='Behavior18', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior17','Mood18'], evidence_card=[2,2])
cpd_behavior19 = TabularCPD(variable='Behavior19', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior18','Mood19'], evidence_card=[2,2])
cpd_behavior20 = TabularCPD(variable='Behavior20', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior19','Mood20'], evidence_card=[2,2])
cpd_behavior21 = TabularCPD(variable='Behavior21', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior20','Mood21'], evidence_card=[2,2])
cpd_behavior22 = TabularCPD(variable='Behavior22', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior21','Mood22'], evidence_card=[2,2])
cpd_behavior23 = TabularCPD(variable='Behavior23', variable_card=2, values = [[0.7,0.4,0.6,0.3],
									    [0.3,0.6,0.4,0.7]], evidence=['Behavior22','Mood23'], evidence_card=[2,2])"""
							    


WulfNet.add_cpds(cpd_nap0,cpd_nap1,cpd_nap2,cpd_nap3,cpd_nap4)#,cpd_nap5)#,cpd_nap6,cpd_nap7,cpd_nap8,cpd_nap9,cpd_nap10,cpd_nap11,cpd_nap12,cpd_nap13,cpd_nap14,cpd_nap15,cpd_nap16,cpd_nap17,cpd_nap18,cpd_nap19,cpd_nap20,cpd_nap21,cpd_nap22,cpd_nap23)
WulfNet.add_cpds(cpd_play0,cpd_play1,cpd_play2,cpd_play3,cpd_play4)#,cpd_play5)#,cpd_play6,cpd_play7,cpd_play8,cpd_play9,cpd_play10,cpd_play11,cpd_play12,cpd_play13,cpd_play14,cpd_play15,cpd_play16,cpd_play17,cpd_play18,cpd_play19,cpd_play20,cpd_play21,cpd_play22,cpd_play23)
WulfNet.add_cpds(cpd_meal0,cpd_meal1,cpd_meal2,cpd_meal3,cpd_meal4)#,cpd_meal5)#,cpd_meal6,cpd_meal7,cpd_meal8,cpd_meal9,cpd_meal10,cpd_meal11,cpd_meal12,cpd_meal13,cpd_meal14,cpd_meal15,cpd_meal16,cpd_meal17,cpd_meal18,cpd_meal19,cpd_meal20,cpd_meal21,cpd_meal22,cpd_meal23)
WulfNet.add_cpds(cpd_mood0,cpd_mood1,cpd_mood2,cpd_mood3,cpd_mood4)#,cpd_mood5)#,cpd_mood6,cpd_mood7,cpd_mood8,cpd_mood9,cpd_mood10,cpd_mood11,cpd_mood12,cpd_mood13,cpd_mood14,cpd_mood15,cpd_mood16,cpd_mood17,cpd_mood18,cpd_mood19,cpd_mood20,cpd_mood21,cpd_mood22,cpd_mood23)
WulfNet.add_cpds(cpd_behavior0,cpd_behavior1,cpd_behavior2,cpd_behavior3,cpd_behavior4)#,cpd_behavior5)#,cpd_behavior6,cpd_behavior7,cpd_behavior8,cpd_behavior9,cpd_behavior10,cpd_behavior11,cpd_behavior12,cpd_behavior13,cpd_behavior14,cpd_behavior15,cpd_behavior16,cpd_behavior17,cpd_behavior18,cpd_behavior19,cpd_behavior20,cpd_behavior21,cpd_behavior22,cpd_behavior23)

WulfNet.check_model()		

model = WulfNet.copy()

infer = BeliefPropagation(model)

def get_evidence():
	Behavior = list(input("Behavior Sequence: "))
	Nap = list(input("Nap Sequence: "))
	Meal = list(input("Meal Sequence: "))
	Play = list(input("Play Sequence: "))
	observed = {'Behavior0':int(Behavior[0]),
	    'Behavior1':int(Behavior[1]),
	    'Behavior2':int(Behavior[2]),
	    'Behavior3':int(Behavior[3]),
	    'Behavior4':int(Behavior[4]),
	    'Behavior5':int(Behavior[5]),
	    'Behavior6':int(Behavior[6]),
	    'Behavior7':int(Behavior[7]),
	    'Behavior8':int(Behavior[8]),
	    'Behavior9':int(Behavior[9]),
	    'Behavior10':int(Behavior[10]),
	    'Behavior11':int(Behavior[11]),
	    'Behavior12':int(Behavior[12]),
	    'Behavior13':int(Behavior[12]),
	    'Behavior14':int(Behavior[14]),
	    'Behavior15':int(Behavior[15]),
	    'Behavior16':int(Behavior[16]),
	    'Behavior17':int(Behavior[17]),
	    'Behavior18':int(Behavior[18]),
	    'Behavior19':int(Behavior[19]),
	    'Behavior20':int(Behavior[20]),
	    'Behavior21':int(Behavior[21]),
	    'Behavior22':int(Behavior[22]),
	    'Behavior23':int(Behavior[23]),
	    
	    'Nap0':int(Nap[0]),
	    'Nap1':int(Nap[1]),
	    'Nap2':int(Nap[2]),
	    'Nap3':int(Nap[3]),
	    'Nap4':int(Nap[4]),
	    'Nap5':int(Nap[5]),
	    'Nap6':int(Nap[6]),
	    'Nap7':int(Nap[7]),
	    'Nap8':int(Nap[8]),
	    'Nap9':int(Nap[9]),
	    'Nap10':int(Nap[10]),
	    'Nap11':int(Nap[11]),
	    'Nap12':int(Nap[12]),
	    'Nap13':int(Nap[13]),
	    'Nap14':int(Nap[14]),
	    'Nap15':int(Nap[15]),
	    'Nap16':int(Nap[16]),
	    'Nap17':int(Nap[17]),
	    'Nap18':int(Nap[18]),
	    'Nap19':int(Nap[19]),
	    'Nap20':int(Nap[20]),
	    'Nap21':int(Nap[21]),
	    'Nap22':int(Nap[22]),
	    'Nap23':int(Nap[23]),
	    
	    'Meal0':int(Meal[0]),
	    'Meal1':int(Meal[1]),
	    'Meal2':int(Meal[2]),
	    'Meal3':int(Meal[3]),
	    'Meal4':int(Meal[4]),
	    'Meal5':int(Meal[5]),
	    'Meal6':int(Meal[6]),
	    'Meal7':int(Meal[7]),
	    'Meal8':int(Meal[8]),
	    'Meal9':int(Meal[9]),
	    'Meal10':int(Meal[10]),
	    'Meal11':int(Meal[11]),
	    'Meal12':int(Meal[12]),
	    'Meal13':int(Meal[13]),
	    'Meal14':int(Meal[14]),
	    'Meal15':int(Meal[15]),
	    'Meal16':int(Meal[16]),
	    'Meal17':int(Meal[17]),
	    'Meal18':int(Meal[18]),
	    'Meal19':int(Meal[19]),
	    'Meal20':int(Meal[20]),
	    'Meal21':int(Meal[21]),
	    'Meal22':int(Meal[22]),
	    'Meal23':int(Meal[23]),
	    
	    'Play0':int(Play[0]),
	    'Play1':int(Play[1]),
	    'Play2':int(Play[2]),
	    'Play3':int(Play[3]),
	    'Play4':int(Play[4]),
	    'Play5':int(Play[5]),
	    'Play6':int(Play[6]),
	    'Play7':int(Play[7]),
	    'Play8':int(Play[8]),
	    'Play9':int(Play[9]),
	    'Play10':int(Play[10]),
	    'Play11':int(Play[11]),
	    'Play12':int(Play[12]),
	    'Play13':int(Play[13]),
	    'Play14':int(Play[14]),
	    'Play15':int(Play[15]),
	    'Play16':int(Play[16]),
	    'Play17':int(Play[17]),
	    'Play18':int(Play[18]),
	    'Play19':int(Play[19]),
	    'Play20':int(Play[20]),
	    'Play21':int(Play[21]),
	    'Play22':int(Play[22]),
	    'Play23':int(Play[23])}
	return observed

#observed = get_evidence()
query_vars = ['Mood0','Mood1','Mood2','Mood3','Mood4']
observed = {'Behavior0':1,'Behavior1':0,'Nap0':0}
#query = infer.query(variables=query_vars, evidence=observed)
#print(query)	
print("\n")
print("Executing Network Query...please wait")
map_query = infer.map_query(variables=query_vars, evidence=observed)
print("Maximum A Posteriori Mood State Sequence: ")
print(map_query)
